# python/setup.py.in
# python/setup.py.in
from setuptools import setup, Extension
from setuptools.command.build_ext import build_ext
import sysconfig
import os

class CMakeExtension(Extension):
    def __init__(self, name):
        super().__init__(name, sources=[])

class BuildExt(build_ext):
    def run(self):
        # CMake로 이미 빌드되었으므로 skip
        pass

    def get_ext_filename(self, ext_name):
        # 런타임에 올바른 확장자를 가져옴 (예: .cpython-314-darwin-arm64-apple-darwin25.2.0.so)
        ext_suffix = sysconfig.get_config_var("EXT_SUFFIX")
        return os.path.join("mosaic_core", "_mosaic_core" + ext_suffix)

setup(
    name="mosaic-core",
    version="@PROJECT_VERSION@",
    author="Your Name",
    description="MOSAIC Core Python Bindings",
    long_description=open("@CMAKE_CURRENT_SOURCE_DIR@/README.md").read() if os.path.exists("@CMAKE_CURRENT_SOURCE_DIR@/README.md") else "",
    packages=["mosaic_core"],
    package_dir={"mosaic_core": "@CMAKE_BINARY_DIR@/mosaic_core"},
    ext_modules=[CMakeExtension("mosaic_core._mosaic_core")],
    cmdclass={"build_ext": BuildExt},
    zip_safe=False,
    python_requires=">=3.7",
)
